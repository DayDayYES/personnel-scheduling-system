# 工序规则配置功能使用说明

## 📋 功能概述

工序规则配置功能允许管理员配置每个工序的基础参数，包括工作时长、阶段顺序、团队分配、团队规模等信息。

---

## 🎯 功能特点

### 1. 防误触设计
- 默认进入**只读模式**，防止误操作
- 需点击"编辑"按钮才能进行修改
- 编辑模式下有明显的提示信息

### 2. 数据验证
- 基础工作时长必须≥0
- 阶段顺序必须≥1
- 团队规模必须≥1
- 保存前自动验证所有数据

### 3. 取消保护
- 点击"取消"时会二次确认
- 未保存的修改会丢失提醒
- 可选择继续编辑或确认取消

### 4. 配置项
每个工序可配置以下参数：
- ✅ **基础工作时长**：数字，支持小数（精度0.01），步长0.5
- ✅ **时长单位**：小时/分钟/天
- ✅ **阶段顺序**：整数（1-20）
- ✅ **所属团队**：团队1-团队6，单选
- ✅ **团队规模**：整数（1-100人）
- ✅ **备注说明**：文本，最多200字

**并行规则**：同一阶段内的工序默认可并行执行（只要满足团队约束）

---

## 🚀 使用步骤

### 步骤1：执行SQL创建表
在MySQL中执行：
```sql
-- 执行文件 demo/src/sql/process_rule_table.sql
```
这将创建 `process_rule` 表并初始化16个工序的默认配置。

### 步骤2：重启后端服务
重启Spring Boot应用，确保新的Entity、Mapper、Service、Controller都已加载。

### 步骤3：刷新前端页面
按 `Ctrl + F5` 强制刷新浏览器。

### 步骤4：打开规则配置
1. 进入"工序管理"页面
2. 点击顶部的"规则配置"按钮（橙色渐变按钮）
3. 弹出"工序规则配置"对话框

### 步骤5：查看规则
- 对话框显示16个工序的完整配置信息
- 默认为**只读模式**，所有字段不可编辑
- 顶部显示蓝色提示："当前为只读模式，点击'编辑'按钮进行修改"
- 表格显示6列：工序名称、基础工作时长、时长单位、阶段顺序、所属团队、团队规模、备注说明

### 步骤6：编辑规则
1. 点击"编辑"按钮
2. 提示变为橙色："当前为编辑模式，修改后请点击'保存'按钮"
3. 所有输入框、下拉框变为可编辑状态
4. 修改需要更新的参数

### 步骤7：保存或取消
**保存**：
- 点击"保存"按钮
- 系统自动验证数据有效性
- 验证通过后批量更新到数据库
- 提示"保存成功"
- 自动切换回只读模式

**取消**：
- 点击"取消"按钮
- 弹出确认对话框："确定要取消编辑吗？未保存的修改将丢失。"
- 选择"确定"：恢复原始数据，切换回只读模式
- 选择"继续编辑"：保持编辑模式

### 步骤8：关闭对话框
点击底部的"关闭"按钮关闭对话框。

---

## 📊 配置项详细说明

### 1. 基础工作时长
- **类型**：数字（支持小数）
- **范围**：0-999
- **精度**：小数点后2位
- **步长**：0.5（点击上下箭头每次增减0.5）
- **说明**：单个工序的基准工作时长

### 2. 时长单位
- **类型**：下拉选择
- **选项**：
  - 小时
  - 分钟
  - 天
- **说明**：配合"基础工作时长"使用

### 3. 阶段顺序
- **类型**：整数
- **范围**：1-20
- **说明**：工序在整个流程中的执行顺序，数字越小越先执行

### 4. 所属团队
- **类型**：下拉选择
- **选项**：
  - 团队1 (team1)
  - 团队2 (team2)
  - 团队3 (team3)
  - 团队4 (team4)
  - 团队5 (team5)
  - 团队6 (team6)
- **说明**：该工序由哪个团队负责

### 5. 团队规模
- **类型**：整数
- **范围**：1-100
- **说明**：该团队的总人数

### 6. 备注说明
- **类型**：多行文本
- **长度**：最多200字符
- **说明**：对该工序规则的补充说明

---

## 🗂️ 数据库结构

### 表名：`process_rule`

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| id | INT | 主键ID | 1 |
| process_code | VARCHAR(50) | 工序代码 | scaffold |
| process_name | VARCHAR(100) | 工序名称 | 搭架子 |
| base_duration | DECIMAL(10,2) | 基础工作时长 | 2.0 |
| duration_unit | VARCHAR(20) | 时长单位 | 小时 |
| stage_order | INT | 阶段顺序 | 1 |
| team_name | VARCHAR(50) | 所属团队 | team1 |
| team_size | INT | 团队规模 | 10 |
| description | VARCHAR(500) | 备注说明 | ... |
| create_time | DATETIME | 创建时间 | 2025-01-16 12:00:00 |
| update_time | DATETIME | 更新时间 | 2025-01-16 13:00:00 |

**唯一索引**：`uk_process_code` (process_code)

---

## 🔧 API接口说明

### 1. 查询所有规则
```
GET /processRule/list
```
**返回**：按阶段顺序排序的规则列表

### 2. 根据代码查询
```
GET /processRule/getByCode/{processCode}
```
**参数**：`processCode` - 工序代码
**返回**：单个规则对象

### 3. 更新单个规则
```
POST /processRule/update
```
**参数**：规则对象（JSON）
**返回**：更新结果

### 4. 批量更新规则
```
POST /processRule/batchUpdate
```
**参数**：规则列表（JSON数组）
**返回**：批量更新结果

---

## 🎨 界面预览

### 只读模式
```
┌─────────────────────────────────────────────────────────────┐
│  当前为只读模式，点击"编辑"按钮进行修改     [编辑]         │
├──────┬────────┬────────┬────────┬────────┬────────┬────────┤
│工序  │基础工作│时长单位│阶段顺序│所属团队│团队规模│备注说明│
│名称  │时长    │        │        │        │(人数)  │        │
├──────┼────────┼────────┼────────┼────────┼────────┼────────┤
│搭架子│  2.0   │ 小时   │   1    │ 团队1  │ 10 人  │  -     │
│拆保温│  1.5   │ 小时   │   2    │ 团队1  │ 10 人  │  -     │
│...   │  ...   │  ...   │  ...   │  ...   │  ...   │  ...   │
└──────┴────────┴────────┴────────┴────────┴────────┴────────┘
                            [关闭]
```

### 编辑模式
```
┌─────────────────────────────────────────────────────────────┐
│  当前为编辑模式，修改后请点击"保存"按钮  [保存] [取消]     │
├──────┬────────┬────────┬────────┬────────┬────────┬────────┤
│工序  │基础工作│时长单位│阶段顺序│所属团队│团队规模│备注说明│
│名称  │时长    │        │        │        │(人数)  │        │
├──────┼────────┼────────┼────────┼────────┼────────┼────────┤
│搭架子│[2.0 ▲▼]│[小时▼] │ [1 ▲▼] │[团队1▼]│[10 ▲▼] │[输入框]│
│拆保温│[1.5 ▲▼]│[小时▼] │ [2 ▲▼] │[团队1▼]│[10 ▲▼] │[输入框]│
│...   │  ...   │  ...   │  ...   │  ...   │  ...   │  ...   │
└──────┴────────┴────────┴────────┴────────┴────────┴────────┘
                            [关闭]
```

---

## ⚠️ 注意事项

### 1. 数据一致性
- 修改规则后，已存在的工序数据不会自动更新
- 规则主要用于新建工序时的默认值
- 如需更新现有工序，请在"工序管理"中逐个修改

### 2. 阶段顺序
- 阶段顺序决定工序执行的先后
- 相同阶段的工序可并行执行（如果isParallel=true）
- 建议合理规划阶段顺序，避免依赖冲突

### 3. 团队配置
- 团队1-6是预设的团队编号
- 团队规模应该与实际团队人数匹配
- 同一团队的工序会共享人力资源

### 4. 并行规则
- **同一阶段内的工序默认可并行执行**（只要满足团队约束）
- 不同阶段的工序按顺序执行
- 合理规划阶段顺序，避免依赖冲突

### 5. 数据验证
- 系统会自动验证必填字段和数值范围
- 验证失败会有明确的错误提示
- 请按提示修正后再保存

---

## 🔍 常见问题

### Q1: 修改规则后，现有工序数据会变吗？
**A**: 不会。规则配置主要用于新建工序时的默认值，不影响已存在的工序数据。

### Q2: 可以删除工序规则吗？
**A**: 不建议删除。如果某个工序暂时不用，可以将其阶段顺序设置得很大，或在备注中标注"已停用"。

### Q3: 团队名称可以自定义吗？
**A**: 当前版本使用固定的team1-team6。如需自定义，需要修改数据库和前端代码。

### Q4: 忘记保存就关闭对话框了怎么办？
**A**: 未保存的修改会丢失。重新打开对话框会显示数据库中的最新数据。

### Q5: 批量更新失败怎么办？
**A**: 检查后端日志，确认：
- 数据库连接正常
- 所有字段值符合要求
- 没有主键冲突

---

## 📞 技术支持

如有问题，请检查：
1. 数据库表是否正确创建
2. 后端服务是否正常启动
3. 浏览器控制台是否有错误信息
4. 网络请求是否成功（F12 -> Network）

---

**创建日期**：2025年11月17日  
**功能版本**：v1.0  
**适用系统**：工序管理系统

