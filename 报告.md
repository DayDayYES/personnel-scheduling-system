# 多设备人员调度优化模型

## 摘要

本研究针对典型化工车间的多设备人员调度问题，建立了一个考虑跨设备资源共享的优化模型。该模型在传统单设备调度模型的基础上，引入了设备维度，实现了多个设备并行作业时的团队人员动态分配。模型考虑了工序间的顺序约束、并行工序的协同、专用团队与共用团队的差异化管理，以及人员分配对工序时间的非线性影响。目标是在满足所有约束条件下，最小化所有设备的最大完工时间（makespan），从而提高车间整体生产效率。

## 1. 问题描述

### 1.1 研究背景

在现代化工生产车间中，通常存在多个设备需要同时进行维护、检修或加工任务。每个设备上的任务包含若干道工序，这些工序需要按照特定的阶段顺序完成。车间内配备有多个专业加工团队，这些团队在不同设备间共享使用。

传统的单设备调度模型仅考虑一个设备上的工序排序和人员分配问题，无法应对多设备并行作业的实际场景。当多个设备同时运行时，团队人员需要在不同设备间进行动态调度，这带来了新的挑战：

1. **跨设备资源竞争**：多个设备可能同时需要同一团队的人员，需要合理分配有限的人力资源
2. **时间依赖的约束**：团队在不同设备上的工作时间段可能重叠，需要确保任意时刻的人员分配总和不超过团队规模
3. **设备间并行性**：不同设备的工序可以并行执行，增加了调度的复杂度和优化空间
4. **专用与共用团队的差异**：专用团队同一时刻只能服务一个工序，共用团队可以分散到多个工序

### 1.2 问题特征

本研究考虑的多设备人员调度问题具有以下特征：

1. **多设备并行作业**：车间内有 $K$ 个设备需要同时进行加工，每个设备有独立的工序序列
2. **阶段化工序结构**：每个设备的工序按阶段组织，阶段间必须顺序执行，阶段内的工序可能顺序执行或并行执行
3. **团队跨设备共享**：车间内有 $M$ 个团队，这些团队可以在不同设备间调度使用
4. **团队类型差异**：
   - **专用团队**：同一时刻只能执行一个工序，必须使用全部人员，完成后才能转移到其他工序
   - **共用团队**：可以将人员分散到多个工序，但任意时刻所有工序的人员分配总和不能超过团队规模
5. **人员分配灵活性**：共用团队的工序可以灵活分配人数（不少于最小人数），人员数量影响工序完成时间
6. **非线性时间关系**：工序完成时间与分配人数呈非线性关系，考虑了人员效率和团队协作效应

### 1.3 优化目标

在满足所有约束条件的前提下，合理安排各设备的工序开始时间和团队人员分配方案，使得所有设备的最大完工时间（makespan）最小，从而提高车间整体生产效率，缩短总体完工周期。

## 2. 符号定义

### 2.1 集合与索引

| 符号 | 含义 |
|------|------|
| $K$ | 设备集合，$k \in K = \{1, 2, \ldots, K\}$ |
| $M$ | 团队集合，$m \in M = \{1, 2, \ldots, M\}$ |
| $I_k$ | 设备 $k$ 的阶段集合，$i \in I_k$ |
| $J_{k,i}$ | 设备 $k$ 的阶段 $i$ 的工序集合，$j \in J_{k,i}$ |

### 2.2 参数

| 符号 | 含义 |
|------|------|
| $P_m$ | 团队 $m$ 的人员总数 |
| $P_{k,i,j}$ | 设备 $k$ 阶段 $i$ 工序 $j$ 的标准团队规模（完成该工序的理想人数） |
| $D_{k,i,j}$ | 设备 $k$ 阶段 $i$ 工序 $j$ 的指定加工时间（标准团队规模下的基准时间） |
| $M_{k,i,j}$ | 设备 $k$ 阶段 $i$ 工序 $j$ 对应的团队编号（工序与团队的映射关系） |
| $\text{Ded}_{k,i,j}$ | 设备 $k$ 阶段 $i$ 工序 $j$ 是否为专用团队工序，$\text{Ded}_{k,i,j} \in \{0,1\}$（1表示专用，0表示共用） |
| $Y_{k,i}$ | 设备 $k$ 阶段 $i$ 的工序是否可并行，$Y_{k,i} \in \{0,1\}$（1表示可并行，0表示顺序执行） |

### 2.3 决策变量

| 符号 | 含义 |
|------|------|
| $X_{k,i,j,m}$ | 团队 $m$ 分配到设备 $k$ 阶段 $i$ 工序 $j$ 的人数（连续变量，$X_{k,i,j,m} \geq 0$） |
| $S_{k,i,j}$ | 设备 $k$ 阶段 $i$ 工序 $j$ 的开始时间 |
| $O_{k,i,j}$ | 设备 $k$ 阶段 $i$ 工序 $j$ 的完成时间 |
| $T_{k,i,j}$ | 设备 $k$ 阶段 $i$ 工序 $j$ 的实际加工时间 |

## 3. 数学模型

### 3.1 工序加工时间计算

工序的实际加工时间受分配人数的影响。当分配人数与标准团队规模不同时，需要根据人员效率和团队协作效应进行调整。

$$T_{k,i,j} = D_{k,i,j} \times \frac{P_{k,i,j}}{X_{k,i,j,M_{k,i,j}}} \times \alpha_{k,i,j} \times \beta_{k,i,j}$$

其中：

**人员分配效率因子** $\alpha_{k,i,j}$：反映人员数量对工作效率的影响。当分配人数较少时，效率较低（最低0.6）；当分配人数接近标准规模时，效率提高（最高1.0）。

$$\alpha_{k,i,j} = 0.6 + 0.4 \times \frac{X_{k,i,j,M_{k,i,j}}}{P_{k,i,j}}$$

**团队协作加速因子** $\beta_{k,i,j}$：反映团队协作带来的加速效应。人数越多，协作效果越明显，但存在边际递减效应。

$$\beta_{k,i,j} = 1 - 0.2 \times \left(\frac{X_{k,i,j,M_{k,i,j}}}{P_{k,i,j}}\right)^{0.5}$$

**时间计算说明**：
- 第一项 $\frac{P_{k,i,j}}{X_{k,i,j,M_{k,i,j}}}$ 表示人数减少导致的时间延长（反比关系）
- $\alpha_{k,i,j}$ 修正了人员不足时的效率损失
- $\beta_{k,i,j}$ 体现了多人协作的加速效应
- 综合效果：人数增加时，工序时间缩短，但存在边际递减

### 3.2 约束条件

#### 约束 (1)：工序人员分配约束

每个工序必须分配至少1名人员进行加工，且只能由对应的团队执行（不允许跨团队分配）：

$$X_{k,i,j,m} \geq 1, \quad \forall k \in K, i \in I_k, j \in J_{k,i}, m = M_{k,i,j}$$

$$X_{k,i,j,m} = 0, \quad \forall k \in K, i \in I_k, j \in J_{k,i}, m \neq M_{k,i,j}$$

**约束说明**：第一个不等式确保每个工序至少有1人执行，第二个等式确保工序只能由指定团队执行，避免技能不匹配。

#### 约束 (2)：跨设备团队容量约束（核心新增约束）

这是多设备模型的核心约束，确保团队人员在不同设备间的合理分配。

**对于共用团队**（$\text{Ded}_{k,i,j}=0$），在任意时刻 $t$，所有设备上该团队正在执行的工序所分配的人数总和不得超过团队规模：

$$\sum_{k \in K} \sum_{i \in I_k} \sum_{j \in J_{k,i}} X_{k,i,j,m} \times \mathbb{I}(S_{k,i,j} \leq t < O_{k,i,j}) \leq P_m$$

$$\forall m \in M, \text{Ded}_{k,i,j}=0, \forall t \geq 0$$

其中 $\mathbb{I}(\cdot)$ 为指示函数，当工序在时刻 $t$ 正在执行时为1，否则为0。

**约束说明**：该约束在整个时间轴上动态检查团队的人员分配。例如，若团队2有10人，在时刻 $t=15$ 时，设备1的工序A分配了6人，设备2的工序B分配了3人，则总分配为9人，满足约束；若再启动设备3的工序C并分配2人，则总分配为11人，违反约束。

**对于专用团队**（$\text{Ded}_{k,i,j}=1$），同一时刻只能执行一个工序，且必须使用全部人员：

$$\sum_{k \in K} \sum_{i \in I_k} \sum_{j \in J_{k,i}} \mathbb{I}(S_{k,i,j} \leq t < O_{k,i,j}) \leq 1$$

$$\forall m \in M, M_{k,i,j}=m, \text{Ded}_{k,i,j}=1, \forall t \geq 0$$

$$X_{k,i,j,m} = P_m, \quad \forall k \in K, i \in I_k, j \in J_{k,i}, m = M_{k,i,j}, \text{Ded}_{k,i,j}=1$$

**约束说明**：专用团队（如射线检测团队）需要全员集中作业，不能分散。第一个约束确保同一时刻最多执行一个工序，第二个约束确保使用全部人员。专用团队完成当前工序后，可以转移到其他设备的工序。

#### 约束 (3)：设备内阶段顺序约束

每个设备内，工序按阶段组织，阶段间必须顺序执行。阶段 $i$ 的任何工序必须在阶段 $i-1$ 的所有工序完成后才能开始：

$$S_{k,i,j} \geq \max_{j' \in J_{k,i-1}} \{O_{k,i-1,j'}\}, \quad \forall k \in K, i \geq 2, j \in J_{k,i}$$

**约束说明**：该约束体现了工艺流程的顺序性。例如，设备1的阶段2（打磨）必须等待阶段1（拆保温）的所有工序完成后才能开始。不同设备之间的阶段是独立的，设备1的阶段2不需要等待设备2的阶段1。

#### 约束 (4)：设备内工序顺序约束

当阶段 $i$ 的工序按顺序加工时（$Y_{k,i}=0$），阶段内的工序也必须顺序执行，工序 $j$ 必须在工序 $j-1$ 完成后才能开始：

$$S_{k,i,j} \geq O_{k,i,j-1}, \quad \forall k \in K, i \in I_k, j \geq 2, Y_{k,i}=0$$

**约束说明**：该约束仅在阶段内工序需要顺序执行时生效。例如，某些检验工序需要按特定顺序进行，前一个工序的结果影响后一个工序的执行。

#### 约束 (5)：设备内并行工序的团队互斥约束

当阶段 $i$ 的工序可并行时（$Y_{k,i}=1$），同一阶段的多个工序可以同时执行。

对于**共用团队**的并行工序，人员分配已由约束(2)保证，无需额外约束。

对于**专用团队**的并行工序，由于专用团队同一时刻只能执行一个工序，因此同一专用团队的不同并行工序不能时间重叠：

$$S_{k,i,j} \geq O_{k,i,j'}, \quad \forall k \in K, i \in I_k, j \neq j' \in J_{k,i}$$

$$\text{s.t. } M_{k,i,j}=M_{k,i,j'}, \text{Ded}_{k,i,j}=1, Y_{k,i}=1$$

**约束说明**：例如，阶段4有三个并行工序（宏观检验、壁厚测定、射线检测），前两个由共用团队执行可以同时进行，但射线检测由专用团队执行，该团队在完成射线检测前不能执行其他工序。

#### 约束 (6)：工序完成时间计算

工序的完成时间等于开始时间加上实际加工时间：

$$O_{k,i,j} = S_{k,i,j} + T_{k,i,j}, \quad \forall k \in K, i \in I_k, j \in J_{k,i}$$

#### 约束 (7)：非负性约束

所有时间变量和人员分配变量必须非负：

$$S_{k,i,j} \geq 0, \quad O_{k,i,j} \geq 0, \quad T_{k,i,j} \geq 0, \quad X_{k,i,j,m} \geq 0$$

$$\forall k \in K, i \in I_k, j \in J_{k,i}, m \in M$$

### 3.3 目标函数

优化目标是最小化所有设备的最大完工时间（makespan），即所有工序中最晚完成的时间：

$$\min Z = \max_{k \in K, i \in I_k, j \in J_{k,i}} \{O_{k,i,j}\}$$

**目标函数说明**：该目标函数体现了车间整体效率的优化。通过最小化makespan，可以缩短总体完工周期，提高设备利用率和人员利用率。

**等价线性化形式**（便于求解）：

$$\begin{aligned}
\min \quad & Z \\
\text{s.t.} \quad & Z \geq O_{k,i,j}, \quad \forall k \in K, i \in I_k, j \in J_{k,i}
\end{aligned}$$

引入辅助变量 $Z$ 表示makespan，通过线性约束将非线性的max函数转化为线性形式，便于使用优化算法求解。

## 4. 模型特点与创新

### 4.1 模型特点

1. **多设备并行调度**：模型支持多个设备同时进行加工，设备间工序独立，无跨设备依赖关系。这使得模型能够充分利用设备并行性，提高车间整体生产效率。

2. **跨设备资源共享**：团队在不同设备间共享，模型通过时间依赖的容量约束（约束2），实时监控人员分配，确保任意时刻团队总分配不超过团队规模。这是多设备模型的核心创新点。

3. **灵活的人员分配**：共用团队可以将人员分散到多个设备的不同工序，实现资源的灵活调配；专用团队同一时刻只能服务一个工序，但可以在不同设备间切换，体现了不同团队类型的差异化管理。

4. **时间依赖的约束**：人员容量约束需要在整个时间轴上动态检查，确保资源冲突得到避免。这增加了模型的复杂度，但更贴近实际生产场景。

5. **非线性时间函数**：工序时间受人员分配影响，模型通过效率因子 $\alpha$ 和协作因子 $\beta$ 体现了规模效应（人多速度快）和协作效应（人员协调成本），使时间估算更加准确。

### 4.2 模型与原单设备模型的对比

| 维度 | 原单设备模型 | 新多设备模型 |
|------|-------------|-------------|
| **决策空间** | 工序顺序 + 人员分配 | 工序顺序 + 人员分配 + **设备间调度** |
| **约束复杂度** | $O(I \times J)$ | $O(K \times I \times J)$ |
| **资源竞争** | 仅工序间竞争团队 | **跨设备工序竞争团队** |
| **并行性** | 同一阶段内并行 | 同一阶段内并行 + **设备间并行** |
| **优化难度** | NP-hard | **更复杂的NP-hard问题** |
| **约束类型** | 静态容量约束 | **时间依赖的动态容量约束** |
| **应用场景** | 单设备维护/检修 | **多设备并行作业车间** |

### 4.3 模型创新点

1. **引入设备维度**：将传统单设备调度模型扩展为多设备模型，增加了设备索引 $k$，使模型能够处理多设备并行作业场景。

2. **跨设备团队容量约束**：提出了时间依赖的跨设备团队容量约束（约束2），这是多设备调度的核心难点。该约束确保团队在所有设备上的人员分配总和在任意时刻都不超过团队规模。

3. **差异化团队管理**：区分专用团队和共用团队，针对不同类型团队设计不同的约束条件，使模型更贴近实际生产管理需求。

4. **设备间独立性与资源共享的平衡**：模型既保证了设备间工序的独立性（无跨设备依赖），又实现了团队资源的跨设备共享，在独立性和协同性之间取得平衡。

## 5. 模型求解方法

由于该模型属于复杂的组合优化问题（NP-hard），传统的精确算法难以在合理时间内求解大规模问题。本研究采用**深度强化学习（Deep Reinforcement Learning, DRL）**方法进行求解，具体使用**双深度Q网络（Double Deep Q-Network, DDQN）**算法。

### 5.1 强化学习建模

- **状态（State）**：包括各工序状态、团队可用性、设备完成度、当前时间等信息
- **动作（Action）**：包括启动某个工序并分配人数、批量启动并行工序、推进时间等
- **奖励（Reward）**：负的时间增量，鼓励更快完成所有工序
- **目标**：学习最优调度策略，最小化makespan

### 5.2 算法优势

1. **处理复杂约束**：强化学习可以通过环境交互自动学习满足约束的策略
2. **适应动态场景**：模型训练后可以快速适应不同的工序配置和团队规模
3. **可扩展性强**：算法可以处理大规模问题，设备数量和工序数量增加时仍能有效求解

## 6. 模型应用价值

### 6.1 理论价值

1. 扩展了传统调度理论，将单设备模型推广到多设备场景
2. 提出了时间依赖的跨设备资源约束，丰富了调度理论的约束类型
3. 为多设备人员调度问题提供了数学建模框架

### 6.2 实际应用价值

1. **提高生产效率**：通过优化调度方案，缩短总完工时间，提高设备和人员利用率
2. **降低管理成本**：自动生成调度方案，减少人工排程的时间和错误
3. **增强决策支持**：为管理者提供科学的调度依据，支持多设备并行作业的决策
4. **适应性强**：模型可以适应不同的设备配置、工序结构和团队规模

## 7. 总结

本研究建立了一个多设备人员调度优化模型，该模型在传统单设备调度模型的基础上，引入了设备维度和跨设备团队容量约束，实现了多设备并行作业场景下的人员动态调度。模型考虑了工序顺序约束、并行工序协同、专用与共用团队差异、人员分配对时间的非线性影响等多个实际因素，目标是最小化所有设备的最大完工时间。

该模型的核心创新在于提出了时间依赖的跨设备团队容量约束，确保团队在不同设备间的合理分配。模型采用深度强化学习方法求解，能够有效处理大规模复杂调度问题。研究成果对化工车间、制造车间等多设备并行作业场景具有重要的理论价值和实际应用价值。
